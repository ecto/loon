; lsp.loon â€” Reference: Language Server

[fn ref-lsp-page []
  [doc-page "Language Server" "LSP features and how to set it up in your editor."

    [doc-section "Features"
      [doc-text "The Loon language server speaks the standard Language Server Protocol, so it works with any editor that has LSP support. Here is what you get out of the box."]
      [doc-def "Diagnostics" "Real-time type errors and warnings as you type."]
      [doc-def "Hover Types" "Hover over any expression to see its inferred type."]
      [doc-def "Go to Definition" "Jump to the definition of any binding or function."]
      [doc-def "Completions" "Context-aware suggestions for names, keywords, and builtins."]
      [doc-def "Inlay Hints" "Inline type annotations displayed next to let bindings and function parameters."]]

    [doc-section "VS Code Setup"
      [doc-text "The easiest path. Install the Loon extension from the VS Code marketplace and you are done. The extension handles starting the language server automatically, so there is nothing else to configure."]
      [code-block {:label "SHELL"} "code --install-extension loon-lang.loon-vscode"]]

    [doc-section "Neovim Setup"
      [doc-text "Neovim has excellent LSP support built in. Add this to your config and Loon files will get full language server features as soon as you open them."]
      [code-block {:label "LUA"} [str
        "vim.api.nvim_create_autocmd('FileType', \{\n"
        "  pattern = 'loon',\n"
        "  callback = function()\n"
        "    vim.lsp.start(\{\n"
        "      name = 'loon',\n"
        "      cmd = \{ 'loon', 'lsp' \},\n"
        "      root_dir = vim.fs.dirname(\n"
        "        vim.fs.find(\{ 'main.loon' \}, \{ upward = true \})[1]\n"
        "      ),\n"
        "    \})\n"
        "  end,\n"
        "\})"]]
      [doc-note "tip" "Set filetype detection with: vim.filetype.add(\{ extension = \{ loon = 'loon' \} \})"]]

    [doc-section "Generic LSP Setup"
      [doc-text "If you use a different editor, you can still get full LSP support as long as it has an LSP client. Point it at the Loon binary with these settings."]
      [doc-def "Command" "loon lsp"]
      [doc-def "Transport" "stdio (stdin/stdout)"]
      [doc-def "File types" ".loon"]
      [doc-text "The server communicates over standard input/output using the LSP JSON-RPC protocol. "
        "No special flags or initialization options are required."]]

    [doc-prev-next "Standard Effects" "/ref/effects" "Formatter" "/ref/formatter"]]]
